## 接口技术（1）

### 接口要解决的问题：

1. 速度匹配---------------------------------------->数据的缓冲与暂存
2. 信号的驱动能力------------------------------->信号驱动
3. 信号形式和电平的匹配---------------------->信号类型转换
4. 信息格式---------------------------------------->信号格式转换
5. 时序匹配（定时关系）
6. 总线隔离---------------------------------------->三态门

**接口里的寄存器就是端口，接口是一组电路**

### 接口的功能：

1. 执行CPU命令

* 功能执行
  * CPU按照字格式准备好控制字
  * 接口初始化时，由CPU将控制字写入接口内部寄存器
  * 接口工作时，译码控制字，进行规定操作
* 控制字（命令字）：一串二进制数据
  * 每一位具有不同的含义，表示CPU对外设或接口的控制信息
  * 不同的接口芯片，控制字的数目和格式也不相同

2. 接收（返回）外设状态

* 功能执行
  * 在外设工作期间，接口接受其工作状态信息，形成状态字，保存于状态寄存器中。
    * 状态字随时根据外设状态的变化而变化
  * CPU需要了解外设工作状态时，从接口中直接读取该状态字

* 状态字：一串二进制数据
  * 每一位具有不同的含义，反映当前外设的某种状态

3. 数据缓冲

* 功能执行
  * 作为CPU与外设之间的中转站，调节速度差异
  * 数据保存在接口的数据寄存器中

* 数据缓冲的方式
  * 数据缓冲器暂存数据
  * 数据锁存器暂存数据

4. 设备寻址

* 功能执行
  * 接口内部的数据、控制、状态寄存器都是CPU可以访问的
  * 接口外部和内部都需要对CPU当前的操作部件进行选择
  * 选择方式
    * 根据CPU内部的地址进行译码，从而确定当前的操作部件

5. 信号转换
6. 数据宽度与数据格式转换

* 数据宽度转换
  * 串行接口中需要的串-并、并-串转换
* 数据格式转换
  * 工程接口中常用的数-模、模-数转换
* 时序或电平转换
  * 时序配合

提升CPU带动外部设备的能力。

### 接口的组成：

![image-20211205135940909](C:\Users\fjq\AppData\Roaming\Typora\typora-user-images\image-20211205135940909.png)

**接口里的寄存器就是端口**

### $I$ / $O$端口及其编址

#### 端口：

##### 定义：

接口中用于缓存数据及控制信息的部件。

##### 类型：

1. 数据端口	---->用来传输，存储数据，有输入输出两个端口（可读可写）
2. 状态端口    ---->将外部设备的状态信息送入CPU，通常是输入端口（只读）
3. 控制端口    ---->将CPU发出的各种信息传输出去，并且控制外部设备。（只写）

![image-20211205140842820](C:\Users\fjq\AppData\Roaming\Typora\typora-user-images\image-20211205140842820.png)

#### 	IO端口编址

* 计算机系统中包含各类种类不同功能的接口电路。
* 每个接口中含有1个或多个端口。

##### 端口编址

确保CPU能够访问到每个不同的端口。

##### 寻址端口的方法

* 先找到端口所在的接口电路芯片。---->片选地址
* 再在该芯片上找具体访问的端口。——>片内寻址

每个端口地址 = 片选地址（高位地址） + 片内地址



对8088/8086CPU来讲，它<font color = red>寻址内存</font>的能力是1M字节，所以它可以同时产生20个地址码，它<font color = red>寻址端口</font>的能力是64K字节。

##### <font color = red>端口的编址方式：</font>

*  与内存统一编址
* 独立编址（现采用的编址方式）
  * 将IO系统与主存系统分别编址

采用I/O独立编址方式，与内存公用的地址总线，用IO/#M信号状态区分。

当IO/#M引脚的状态是高电平时，就表示其访问的是端口，A16~A19默认为0，端口占4位，有一位为0。

访问端口时仅用地址总线的：A15~A0

可寻址的I/O端口数为64K(65536)个，I/O地址范围为0~FFFFH

##### I/O端口的地址分配

* IBM-PC机的IO端口地址范围为0~3FFH，共1024个。

##### IO接口硬件分类

* 系统板上的I/O芯片
* I/O扩展槽上的接口控制口

##### I/O端口的地址分配

（与具体的系统有关）

* 0~0FFH ：主机芯片
* 100H~3FFH ：扩展槽

##### <font color = red>输入输出指令</font>

$in$ 与 $out$ 指令

格式：

* 输入指令：

```makefile
IN  AL/AX , PORT/DX
```

* 输出指令

```makefile
OUT  PORT/DX , AL/AX 
```

<font color = orange>寄存器AL/AX与指定端口之间的数据交换</font>

**指令注意**：

* PORT/DX ：根据地址宽度决定表示方法
  * 直接寻址：8位端口地址（0~0FFH），可直接在指令中出现
  * 间接寻址：16位端口地址（0000H~0FFFFH），必须由DX表示
* I/O指令在书写格式上两操作数的位数不一定一致
  * 一个操作数为数据，一个为地址

#### I/O端口地址的译码

##### 端口地址译码的目的

**确定端口地址**

##### 端口地址译码的概念

* I/O端口地址译码电路的作用
  * 将CPU发出的<font color = red>地址信号</font>转换成对应端口的<font color = red>选通信号</font>
* I/O端口地址译码电路的外部信号
  * 输入信号
    * 地址信号A0~A9
    * 读写控制信号IOR#，IOW#
    * DMA地址允许信号AEN
  * 输出信号
    * 芯片或端口的选通信号，低电平有效

