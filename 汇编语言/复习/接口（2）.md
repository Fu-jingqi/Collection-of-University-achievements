## 接口（2）

### 8253A芯片

#### <font color ="bblue">**芯片的工作特点**</font>

* **每片** **8253A** **上都有** **3** **个** **独立的** **16** **位** **的计数通道；**
  * **最大可计数值为** **pow(2,** **16)** **=** **65536** **；** 
* **每个通道计数均可编程设置为** **二进制** **或** **BCD** **码** **计数；**
  * **BCD** **码计数即十进制计数；** 
* **每个计数通道都有** **6** **种** **工作方式，可以编程选择；**
* **计数通道都是** <font color = "red">**减法计数器** </font>**；**

#### <font color ="bblue">**计数通道的外部信号**</font>

* **时钟** **输入** **信号** **CLK**
* **门控** **输入** **信号** **GATE**
  * **可有** <font color = "red">**开关作用**</font> **和** <font color = "red">**触发作用** </font>**；**
* **计数器** **输出** **信号** **OUT**

#### <font color ="bblue">8253A的三个端口</font>

* **计数通道为<font color = "orange">数据端口</font>，每个计数通道分别占用一个端口地址；**
  * <font color = "sdain">**（计数通道** **0 —>200H** **、计数通道** **1—>201H** **、计数通道** **2 —>202H** </font>**）**
* **控制字寄存器为<font color = "orange">命令端口</font>，占用一个端口地址** **（**<font color = "sdain"> **203H**</font> **）** **；**
* **无<font color = "orange">状态端口。</font>**

#### <font color ="bblue">**计数通道的内部结构**</font>

* **16** **位当前计数值锁存器**  **——** **只读**
* **16** **位减** **1** **计数器** **——** **不可访问**
* **16** **位计数初值寄存器** **——** **可读写**

#### <font color ="bblue">**计数初值的设置**</font>

1. **按照命令字格式写出满足当前操作的** **命令字** **，使用** **I/O** **指令将其写入** **命令端口** **；**
2. **确定** **计数初值** **（定时常数），使用** **I/O** **指令将初始值装入指定计数通道的初值寄存器。**

#### <font color ="bblue">**计数初值的范围：**</font>

**二进制：** **0000** **～** **0FFFFH**

**十进制（** **BCD** **码）：** **0000** **～** **9999**

**其中，** <font color ="orange">**最大值为** **0**</font> **，因为计数器计数时先减** **1** **后判断**

**例子：**

![image-20220218132448351](C:\Users\fjq\AppData\Roaming\Typora\typora-user-images\image-20220218132448351.png)

#### <font color ="bblue">**8253A** **的工作方式**</font>

**8253A** **共有** **6** **种工作方式，三个计数通道都可以工作在这** **6** **种工作方式下。**

* **方式** **0** **——** **计数结束产生正脉冲**（**软件触发**）
* **方式** **1** **——** **硬件可重复触发的单脉冲发生器**（**硬件触发**）
* **方式** **2** **——** **分频器**（**软硬件触发**）
* **方式** **3** **——** **方波发生器**（**软硬件触发**）
* **方式** **4** **——** **软件触发选通的单脉冲发生器**（**软件触发**）
* **方式** **5** **——** **硬件触发选通的单脉冲发生器**（**硬件触发**）

### **并行通信接口** **8255A**

#### <font color ="bblue">**8255A** **的主要特性**</font>

* **具有**<font color ="bblue"> **三个** **8** **位** </font>**的** <font color ="bblue">**双向** </font>**数据端口** **(A** **口、** **B** **口、** **C** **口** **)** **；**

* **具有** **3** **种工作方式** **，可通过编程选择**
  * **A** **口** **—** **方式** **0** **、** **1** **、** **2** **；**
  * **B** **口** **—** **方式** **0** **、** **1** **；**
  * **C** **口** **—** **方式** **0**

* **支持无条件、程序查询、中断等数据传送方式；**

* **数据端口** <font color ="bblue">**C** </font>**口** **的使用较为特殊：**

  * **既可作为一个** **8** **位端口，也可作为** **两个** **4** **位端口** **来使用；**
  * **即可作为数据端口，也可用作联络信号配合** **A** **、** **B** **口工作；**

  * **既可传送并行数据，也可** **单独按位控制** **，有专门的控制字。**

#### <font color ="bblue">**三个独立的输入** **/** **输出数据端口（** **A** **、** **B** **、** **C** **口）**</font>

* **端口特点**
  * **3** **个** **8** **位数据端口，都由** **输入寄存器和输出寄存器** **构成；**
  * **A口的输入/输出寄存器均有锁存功能；B、C口的输出寄存器具有锁存功能，但其输入寄存器不能锁存数据；**

* **C** **口的独特工作方式**
  * **A** **、** **B** **口工作于方式** **1** **、** **2** **时，** **C** **口的高** **/** **低** **4** **位分别作为** **A** **、** **B** **口在数据传输时的控制联络信号线；**
  * **C** **口的每一位可独立进行置** **/** **复位的操作。** 

* **设** **A** **、** **B** **、** **C** **口及命令口的端口地址分别为** **60H** **～** **63H** 

#### <font color ="bblue">**8255A** **的控制字**</font>

* **8255A** **共包括两个控制字**
  * **工作方式选择控制字**
    * **指定** **8255A** **的** **3** **个端口工作方式及该方式下的操作类型；**
  * **C** **口置复位控制字**
    * **指定** **C** **口的某一位输出高电平或低电平；**

* **CPU** **对** **8255A** **的编程使用**
  * **向** **8255A** **的命令端口写入工作方式控制字，选择工作方式；**
  * **若需要传送数据，则对** **A** **、** **B** **、** **C** **口进行数据读写；**

  * **若需要** **C** **口发送命令，则可使用** **C** **口置复位控制字来设置；**

* 例子：

![image-20220218153519497](C:\Users\fjq\AppData\Roaming\Typora\typora-user-images\image-20220218153519497.png)

<font color ="bblue">**8255A工作方式及** **编程**</font>

**1** **、基本输入** **/** **输出方式（方式** **0** **）**

*  **基本的输入** **/输出方式**
* **单向** **I/O** **方式**
* **方式** **0** **下的数据传送，可以是** <font color ="orange">**无条件方式**</font> **，或** <font color ="orange">**查询方式**</font>

**2** **、选通输入** **/** **输出方式（方式** **1** **）**

* **带选通的单向** **IO** **方式**
* **方式** **1** **可使用** **查询** **或** **中断** **的方式传送数据；**
* **单向** **I/O** **方式** **，要改变输入** **/** **输出状态，必须重写工作方式控制字；**

**3** **、双向输入** **/** **输出方式（方式** **2** **）**

* **双向选通输入** **/** **输出方式** **，只有** **A** **口可以使用；**
* **工作于方式** **2** **下** **A** **口既可以作数据输入端口，也可以作数据输出端口；**
* **可以用于** **查询** **和** **中断** **方式的数据传送。**

